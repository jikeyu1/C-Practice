# Executor组件 - 需求4实现

## 项目结构
```
需求4-支持掉头功能/
├── executor.h          # Executor类头文件，定义接口
├── executor.cpp        # Executor类实现文件
├── test_executor.cpp   # 单元测试用例
├── CMakeLists.txt      # CMake构建脚本
└── README.md           # 项目说明文档
```

## 功能实现

Executor组件在需求3的基础上，增加了掉头功能，包括：

1. **初始化功能**：设置车的位置(x, y)和朝向(heading)
2. **移动指令**：
   - M：前进/后退1格（正常/倒车状态）或2格（加速/倒车+加速状态）
   - L：左转/右转90度（根据状态）
   - R：右转/左转90度（根据状态）
   - F：切换加速状态（加速 ↔ 正常）
   - B：切换倒车状态（倒车 ↔ 正常）
   - TR：掉头指令
3. **批量指令执行**：支持连续执行多个指令，包括单字符指令和双字符指令TR
4. **状态查询**：获取车当前的位置和朝向

## 掉头功能说明

### 基本掉头行为
- **TR指令**：双字符指令，一起出现时才有效
- **不受倒车状态影响**：无论是否处于倒车状态，TR指令的行为一致
- **受加速状态影响**：加速状态下行为不同

### 正常状态下的掉头（无F）
- 执行顺序：左转90度 → 前进1格 → 左转90度
- 结果：朝向反转180度，位置向左侧移动1格

### 加速状态下的掉头（有F）
- 执行顺序：前进1格 → 左转90度 → 前进1格 → 左转90度
- 结果：朝向反转180度，位置向前和左侧各移动1格

## 状态组合表

| 状态组合 | M指令 | L指令 | R指令 | TR指令 |
|---------|-------|-------|-------|--------|
| 正常（无B无F） | 前进1格 | 左转90度 | 右转90度 | 左转→前进→左转 |
| 加速（无B有F） | 前进2格 | 前进1格+左转90度 | 前进1格+右转90度 | 前进→左转→前进→左转 |
| 倒车（有B无F） | 后退1格 | 右转90度 | 左转90度 | 左转→前进→左转 |
| 倒车+加速（有B有F） | 后退2格 | 后退1格+右转90度 | 后退1格+左转90度 | 前进→左转→前进→左转 |

## 倒车功能说明

### 基本倒车状态（仅B）
- **M指令**：在当前朝向上后退1格，朝向不变
- **L指令**：右转90度，位置不变
- **R指令**：左转90度，位置不变

### 加速+倒车叠加状态（B+F）
- **M指令**：倒退2格（连续执行两次后退1格）
- **L指令**：先后退1格，然后右转90度
- **R指令**：先后退1格，然后左转90度

### 状态切换
- **B指令**：切换倒车状态
- **F指令**：切换加速状态
- **状态叠加**：B和F状态可以叠加，形成4种组合状态
- **多次切换**：连续执行同一状态指令可以取消该状态

## 状态组合表

| 状态组合 | M指令 | L指令 | R指令 |
|---------|-------|-------|-------|
| 正常（无B无F） | 前进1格 | 左转90度 | 右转90度 |
| 加速（无B有F） | 前进2格 | 前进1格+左转90度 | 前进1格+右转90度 |
| 倒车（有B无F） | 后退1格 | 右转90度 | 左转90度 |
| 倒车+加速（有B有F） | 后退2格 | 后退1格+右转90度 | 后退1格+左转90度 |

## 构建和运行测试

### 使用CMake构建

1. 创建构建目录：
   ```bash
   mkdir build
   cd build
   ```

2. 运行CMake生成构建文件：
   ```bash
   cmake ..
   ```

3. 编译项目：
   ```bash
   make
   ```

4. 运行测试：
   ```bash
   ./test_executor
   ```

### 使用g++直接编译

```bash
g++ -std=c++11 -o test_executor test_executor.cpp executor.cpp -lgtest -lpthread
./test_executor
```

## 测试用例

测试用例覆盖了以下场景：

1. 默认构造函数
2. 初始化功能
3. 前进指令（四个方向）
4. 左转指令（连续左转）
5. 右转指令（连续右转）
6. 批量指令执行
7. 复杂批量指令执行

## 设计说明

1. **接口设计**：提供了简洁明了的对外接口，便于使用
2. **封装性**：将内部实现细节隐藏，只暴露必要的接口
3. **可扩展性**：便于后续添加更多功能，如加速、倒车、掉头等
4. **测试驱动开发**：先设计测试用例，再实现功能，确保代码质量
